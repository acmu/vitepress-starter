---
title: 图解网络-笔记
date: 2022-04-15 15:01:20
tags: 笔记
---



[图解网络 小林coding](https://xiaolincoding.com/network/)

## TCP/IP 网络模型有哪几层？

应用层：http、ftp、dns

传输层：udp、tcp（流量控制、超时重传、拥塞控制，有 MSS，即TCP 最大报文段长度，会进行分段，叫tcp段）

网络层：ip协议（ip报文大小超过 MTU，一般为1500自己，会再次进行分片。ipv4 子网掩码）

- 网络层负责将数据从一个设备传输到另一个设备，ip地址细分2种，网络号、主机号，ip地址加子网掩码（按位与）可以计算出网络号和主机号。` 10.100.122.0/24` 后面的`/24`表示就是 `255.255.255.0` ，这是子网掩码的快捷表示方式。这层主要是寻址加路由操作。

网络接口层：在ip头部前加上mac头部，并封装成数据帧发送到网络上。

子网掩码只有一个作用，就是将某个IP地址划分成网络地址和主机地址两部分。

子网掩码是一个32位地址，用于屏蔽IP地址的一部分以区别网络标识和主机标识，并说明该IP地址是在局域网上，还是在广域网上。

[ip地址子网掩码如何换算？子网掩码的功能是什么？](https://www.huaweicloud.com/zhishi/edits-15756157.html)

[如何理解子网掩码？](https://www.zhihu.com/question/56895036)

##  键入网址到网页显示，期间发生了什么？

### http

浏览器解析url，url：协议+服务器地址+服务器目录文件资源

根据信息（请求行、消息头、消息体），生成http请求

### dns 真实地址查询

查询服务器域名对应的ip地址，委托操作系统发消息时，必须要有通信对象的ip地址（类似电话号码不好记忆，但可以使用姓名通讯录映射），dns 服务器就存储了域名和ip地址的映射

实际上域名最后还有一个点，比如` www.server.com.`，这个最后的一个点代表根域名，它只是被省略了。

也就是，. 根域是在最顶层，它的下一层就是 .com 顶级域，再下面是 server.com。

所以域名的层级关系类似一个树状结构：

根 DNS 服务器（.）
顶级域 DNS 服务器（.com）
权威 DNS 服务器（server.com）

我们的电脑上都有一个dns服务器地址（每个dns服务器都存着根服务器的地址），首先我们会问这个dns服务器（如果有缓存，那就直接返回了，如果没有，那么看 hosts 文件，如果还没有，那么才请求），如果它不知道，那么他还能找到根服务器，根服务器会告诉我 .com 服务器的地址，.com 服务器会告诉我 server.com 对应的 ip，最后我就知道了

### 协议栈

IP 中还包括 `ICMP` 协议和 `ARP` 协议。

- `ICMP` 用于告知网络包传送过程中产生的错误以及各种控制信息。
- `ARP` 用于根据 IP 地址查询相应的以太网 MAC 地址。

IP 下面的网卡驱动程序负责控制网卡硬件，而最下面的网卡则负责完成实际的收发操作，也就是对网线中的信号执行发送和接收操作。

### tcp

tcp报文格式：

```
源端口号 16位 + 目的端口号 16位
序号 32位
确认序号 32位
首部长度 4位 + 保留 6位 + 标志位 6位（URG ACK PSH RST SYN FIN）+ 窗口大小 16位
校验和 16位 + 紧急指针 16位
选项
数据
```

序号：解决包乱序问题

确认号：解决丢包问题

窗口大小：用于流量控制（还有拥塞控制）

![tcp三次握手](https://raw.githubusercontent.com/acmu/pictures/master/uPic/2022-04/20_10:33_whg5ZF.png)

三次握手目的是保证双方都有发送和接收的能力。

TCP 的连接状态查看，在 Linux 可以通过 `netstat -napt` 命令查看。

tcp 会根据 MSS 和 MTU 分割数据，之后即可生成tcp报文

### ip

ip 需要原地址ip（客户端ip地址）和目标地址（通过dns域名解析得到的web服务器ip），如果客户端有多个网卡，可通过路由表确定规则确定该使用哪个网卡

### mac

有了ip头之后，还需要加上mac头部，mac头部内容包括：接收方mac地址、发送方mac地址、协议类型，协议一般是 ip协议 与 arp 协议

发送方的 mac地址是在网卡生产时写入ROM（只读存储器）的，接收方的mac地址获取就比较麻烦了，需要通过arp协议广播询问这个ip地址是谁的，之后有路由器认领并通知其mac地址，当然 arp也有缓存（几分钟）

这时mac头部也有了

### 网卡

网络包只是存放在内存中的二进制数据，如果想要真正的传输出去，需要网卡转换成电信号，控制网卡需要网卡驱动程序，网卡会在开头加上报头和起始帧分界符，结尾加上FCS（检测错误帧校验序列），最后网卡会将包转换成电信号，通过网线发送出去

剩下的还有交换机和路由器，mac地址的作用就是找到路由器，找到了之后，路由器会去掉mac报文头。可能跳了好几个路由器，但源ip和目的ip是不会变的，mac地址会变，因为这是代表两个设备之间的传输，之后就是到了服务器了。

国际标准化组织定义了OSI七层网络模型，由于七层过于复杂，一般使用TCP/IP四层模型

