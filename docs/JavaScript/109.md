---
title: å¯é€‰é“¾è¿ç®—ç¬¦
date: 2022-11-04 22:52:49
tags: JavaScript
---

## æè¿°

å¯é€‰é“¾è¿ç®—ç¬¦ï¼ˆoptional chaining operatorï¼‰å³`?.`è¿ç®—ç¬¦ã€‚å®ƒå¯ä»¥è·å–å¯¹è±¡çš„å±æ€§æˆ–è°ƒç”¨æ–¹æ³•ï¼Œå¦‚æœå¯¹è±¡æ˜¯ undefined æˆ– nullï¼Œé‚£ä¹ˆä¼šè¿”å› undefinedï¼Œè€Œä¸æ˜¯ç›´æ¥æŠ›é”™ã€‚

```js
const adventurer = {
    name: 'Alice',
    cat: {
        name: 'Dinah',
    },
};

const dogName = adventurer.dog?.name;
console.log(dogName);
// expected output: undefined

console.log(adventurer.someNonExistentMethod?.());
// expected output: undefined
```

### è¯­æ³•

```
obj.val?.prop
obj.val?.[expr]
obj.func?.(args)
```

æ³¨æ„è¿™é‡Œæ–¹æ³•å’Œå±æ€§å˜é‡çš„ä½¿ç”¨ã€‚

ç®€å•æ¥è¯´ï¼š`?.`è¿ç®—ç¬¦å¾ˆåƒ`.`è¿ç®—ç¬¦ï¼Œé™¤äº†å®ƒä¸ä¼šæŠ¥é”™ã€‚å¦‚æœ `?.`è¿ç®—ç¬¦å‰é¢çš„å†…å®¹æ˜¯ undefined æˆ– nullï¼Œé‚£ä¹ˆåé¢æ¥çš„å±æ€§çš„è·å–æˆ–æ–¹æ³•çš„è°ƒç”¨ï¼Œä¸ä¼šæŠ›é”™ï¼Œå¹¶ä¸”è¿”å› undefinedã€‚

## åœºæ™¯

### è·å–å±æ€§

åœ¨ä¹‹å‰ï¼Œå¦‚æœä½ æƒ³è¦æ¢ç´¢å¯¹è±¡æ˜¯å¦å­˜åœ¨å±æ€§ï¼Œè¦è¿™æ ·ï¼š

```js
const nestedProp = obj.first && obj.first.second;
```

è¿™åœ¨ JS ä¸­æ˜¯æƒ¯ç”¨æ¨¡å¼ï¼Œä½†ä»–æœ‰ä¸€ä¸‹é—®é¢˜ï¼š

1. å½“åµŒå¥—å±‚çº§å¾ˆæ·±æ—¶ï¼Œä»£ç å†—ä½™ï¼Œè¿‡äºå•°å—¦ã€‚
2. å½“`obj.first`çš„å€¼æ˜¯ Falsy çš„æ—¶å€™ï¼Œæ¯”å¦‚`0`ï¼Œé‚£ä¹ˆ`nestedProp`çš„å€¼å°±ä¼šå˜æˆ`0`ï¼Œè€Œä¸æ˜¯æœŸæœ›çš„ `obj.first.second` çš„å€¼æˆ–è€…`undefined`

ä½†å¦‚æœä½ ä½¿ç”¨`?.`è¿ç®—ç¬¦ï¼Œé‚£å°±å¾ˆå¥ˆæ–¯ï¼š

```js
const nestedProp = obj.first?.second;
```

è¿™æ ·å°±è§£å†³äº†ä»¥ä¸Šä¸¤ä¸ªé—®é¢˜ã€‚

> å½“ç„¶ï¼Œä½ å¯èƒ½è§è¿‡å¦ä¸€ç§è§£å†³æ–¹æ¡ˆï¼Œå°±æ˜¯ [lodash çš„ get æ–¹æ³•](https://lodash.com/docs/4.17.15#get)
>
> ```js
> _.get(obj, 'first.second', undefined);
> ```
>
> è¯´å®è¯ï¼Œæˆ‘æ›´å–œæ¬¢è¿™ä¸ªï¼Œå› ä¸ºå®ƒæ›´å¼ºå¤§ï¼Œå¯æƒœçš„æ˜¯ï¼Œè¿™å¹¶ä¸æ˜¯è¯­è¨€æ ‡å‡† ğŸ˜­

æ›´å‡†ç¡®æ¥è¯´ï¼Œ`?.`è¿ç®—ç¬¦å…¶å®æ˜¯ä¸‹é¢çš„è¯­æ³•ç³–ï¼š

```js
const temp = obj.first;
const nestedProp =
    temp === null || temp === undefined ? undefined : temp.second;
```

`?.`è¿ç®—ç¬¦ä¸å¯ä»¥ç”¨åœ¨æ²¡æœ‰å£°æ˜çš„æ ¹å¯¹è±¡ä¸Šï¼ˆå¦‚æœç”¨äº†ä¼šæŠ¥é”™ï¼‰ï¼Œä½†æ˜¯å¯ä»¥ç”¨åœ¨å·²ç»å£°æ˜çš„æ ¹å¯¹è±¡çš„æ²¡æœ‰å®šä¹‰çš„å±æ€§ä¸Šã€‚

![image-2022110480049953 PM](https://raw.githubusercontent.com/acmu/pictures/master/uPic/2022-11/04_20:00_jOkYeL.png)

```js
b?.a;
// Uncaught ReferenceError: b is not defined

let c = {};
c.d?.e;
// undefined
```

b æ˜¯æœªå®šä¹‰çš„å¯¹è±¡ï¼Œä¼šæŠ¥é”™ï¼Œc æ˜¯å®šä¹‰äº†çš„ï¼Œä¸ä¼šæŠ¥é”™ã€‚

### æ‰§è¡Œæ–¹æ³•

```js
const result = someInterface.customMethod?.();
```

å¸¸è§äºä¸€äº› api å¯èƒ½æœªå®ç°çš„æƒ…å†µã€‚è¿™é‡Œçš„è°ƒç”¨ä¼šè¿”å› undefinedï¼Œè€Œä¸æ˜¯æŠ¥é”™ã€‚

æ³¨æ„ï¼šå¦‚æœ`customMethod`æ˜¯å·²ç»å­˜åœ¨çš„å±æ€§ï¼Œä½†ä¸æ˜¯æ–¹æ³•ï¼Œé‚£å³ä½¿è¿™æ ·å†™äº†ä¹Ÿæ˜¯ä¼šæŠ¥é”™çš„ã€‚

### ç”¨äºè¡¨è¾¾å¼

```js
const nestedProp = obj?.['prop' + 'Name'];
```

å¸¸ç”¨äºæ•°ç»„ï¼š

```js
function printMagicIndex(arr) {
    console.log(arr?.[42]);
}

printMagicIndex([0, 1, 2, 3, 4, 5]); // undefined
printMagicIndex(); // undefined; if not using ?., this would throw
```

`?.`è¿ç®—ç¬¦æ˜¯ä¸èƒ½åœ¨èµ‹å€¼å·¦ä¾§ä½¿ç”¨çš„ï¼Œä½†`.`è¿ç®—ç¬¦æ˜¯å¯ä»¥çš„

```js
const object = {};
object?.property = 1; // SyntaxError: Invalid left-hand side in assignmen
```

### çŸ­è·¯æ“ä½œ

```js
const potentiallyNullObj = null;
let x = 0;
const prop = potentiallyNullObj?.[x++];

console.log(x); // 0 as x was not incremented
```

å¦‚æœ`?.`å‰é¢çš„å†…å®¹æ˜¯ nullishï¼Œé‚£ä¹ˆå°±ä¸ä¼šæ‰§è¡Œåé¢çš„è¡¨è¾¾å¼ï¼Œåç»­çš„å±æ€§è®¿é—®ä¹ŸåŒæ ·ä¸ä¼šæ‰§è¡Œ

```js
const potentiallyNullObj = null;
const prop = potentiallyNullObj?.a.b;
// This does not throw, because evaluation has already stopped at
// the first optional chain
```

å…¶å®å°±æ˜¯ä¸‹é¢çš„ä»£ç ï¼š

```js
const potentiallyNullObj = null;
const prop =
    potentiallyNullObj === null || potentiallyNullObj === undefined
        ? undefined
        : potentiallyNullObj.a.b;
```

ä½†ä½ å¦‚æœç”¨æ‹¬å·æå‡ä¼˜å…ˆçº§ï¼Œé‚£ä¹ˆæ˜¯æœ‰å¯èƒ½æŠ¥é”™çš„ï¼š

```js
const potentiallyNullObj = null;
const prop = (potentiallyNullObj?.a).b;
```

## ç¤ºä¾‹

### ç”¨äºå¯é€‰çš„å›è°ƒå‡½æ•°

```js
// Code written without optional chaining
function doSomething(onContent, onError) {
    try {
        // Do something with the data
    } catch (err) {
        // Testing if onError really exists
        if (onError) {
            onError(err.message);
        }
    }
}
```

å› ä¸ºè¿™é‡Œ onError å¯èƒ½æ²¡æœ‰ä¼ å€¼ï¼Œæ‰€ä»¥è¦åˆ¤æ–­ä¸‹ï¼Œä½†å¦‚æœç”¨å¯é€‰é“¾ï¼Œå°±æ¯”è¾ƒç®€å•ï¼š

```js
// Using optional chaining with function calls
function doSomething(onContent, onError) {
    try {
        // Do something with the data
    } catch (err) {
        onError?.(err.message); // No exception if onError is undefined
    }
}
```

### è¿ç»­å¯é€‰é“¾

```js
const customerCity = customer.details?.address?.city;
```

### ä¸ç©ºå€¼åˆå¹¶è¿ç®—ç¬¦ç»“åˆä½¿ç”¨

```js
function printCustomerCity(customer) {
    const customerCity = customer?.city ?? 'Unknown city';
    console.log(customerCity);
}

printCustomerCity({
    name: 'Nathan',
    city: 'Paris',
}); // "Paris"
printCustomerCity({
    name: 'Carl',
    details: { age: 82 },
}); // "Unknown city"
```

## ç©ºå€¼åˆå¹¶è¿ç®—ç¬¦

ç©ºå€¼åˆå¹¶è¿ç®—ç¬¦ å³`??`ï¼Œå®ƒçš„ä½œç”¨æ˜¯å¦‚æœ`??`å·¦è¾¹æ˜¯ nullishï¼Œé‚£ä¹ˆè¿”å›å³è¾¹ï¼Œå¦åˆ™è¿”å›å·¦è¾¹ï¼Œå®ƒå’Œ`||`è¿ç®—ç¬¦å¾ˆç›¸ä¼¼ï¼Œ`||`è¿ç®—ç¬¦å·¦è¾¹æ˜¯ Falsy çš„è¯è¿”å›å³è¾¹ï¼Œå¦åˆ™è¿”å›å·¦è¾¹ã€‚

å‚è€ƒï¼š

[Optional chaining (?.)](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/Optional_chaining)

[nullish](https://developer.mozilla.org/en-US/docs/Glossary/Nullish)

[Falsy](https://developer.mozilla.org/en-US/docs/Glossary/Falsy)

[Nullish coalescing operator (??)](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/Nullish_coalescing)
